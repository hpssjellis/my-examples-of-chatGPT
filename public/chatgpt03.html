<!DOCTYPE html>
<html>
<head>
  <title>WebCam Image Capture and Local Storage v5</title>
</head>
<body>
  <h1>WebCam Image Capture and Local Storage v6</h1>
  <video id="myWebcam" width="640" height="480" autoplay></video>
  <br><br>
  <button id="myCaptureButton">Capture Image</button>
  <button id="myViewButton">View Images</button>
  <div id="myImageContainer"></div>
<script>
  // get elements
  const myWebcam = document.getElementById("myWebcam");
  const myCaptureButton = document.getElementById("myCaptureButton");
  const myViewButton = document.getElementById("myViewButton");
  const myImageContainer = document.getElementById("myImageContainer");

  // check if webcam is available
  if (navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(function (stream) {
        myWebcam.srcObject = stream;
      })
      .catch(function (error) {
        console.log("Something went wrong!");
      });
  }

  // capture image from webcam
  myCaptureButton.addEventListener("click", function() {
    // create canvas to capture image
    const myCanvas = document.createElement("canvas");
    myCanvas.width = 640;
    myCanvas.height = 480;
    const ctx = myCanvas.getContext("2d");
    ctx.drawImage(myWebcam, 0, 0, 640, 480);

    // get current date to use as image file name
    const myDate = new Date();
    const myFileName = myDate.toISOString() + ".png";

    // save image to local storage
    localStorage.setItem(myFileName, myCanvas.toDataURL("image/png"));
  });

  // view all images in local storage
  myViewButton.addEventListener("click", function() {
    // clear previous images
    myImageContainer.innerHTML = "";

    // get all keys (file names) from local storage
    const myKeys = Object.keys(localStorage);

    // loop through keys and create images
    for (let i = 0; i < myKeys.length; i++) {
      const myImage = document.createElement("img");
      myImage.src = localStorage.getItem(myKeys[i]);
      myImageContainer.appendChild(myImage);
    }
  });
</script>
</body>
</html>
